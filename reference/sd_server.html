<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Server logic for a surveydown survey — sd_server • surveydown</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Server logic for a surveydown survey — sd_server"><meta name="description" content="This function defines the server-side logic for a 'shiny' application used in
surveydown. It handles various operations such as conditional display,
progress tracking, page navigation, database updates for survey responses,
and exit survey functionality."><meta property="og:description" content="This function defines the server-side logic for a 'shiny' application used in
surveydown. It handles various operations such as conditional display,
progress tracking, page navigation, database updates for survey responses,
and exit survey functionality."><meta property="og:image" content="https://pkg.surveydown.org/reference/figures/logo.png"><meta property="og:image:alt" content="Logo for the surveydown package"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">surveydown</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.12.8</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="external-link nav-link" href="https://www.surveydown.org/">Documentation</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/surveydown-dev/surveydown/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Server logic for a surveydown survey</h1>
      <small class="dont-index">Source: <a href="https://github.com/surveydown-dev/surveydown/blob/main/R/server.R" class="external-link"><code>R/server.R</code></a></small>
      <div class="d-none name"><code>sd_server.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function defines the server-side logic for a 'shiny' application used in
surveydown. It handles various operations such as conditional display,
progress tracking, page navigation, database updates for survey responses,
and exit survey functionality.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">sd_server</span><span class="op">(</span></span>
<span>  db <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  required_questions <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  all_questions_required <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  start_page <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  auto_scroll <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  rate_survey <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  language <span class="op">=</span> <span class="st">"en"</span>,</span>
<span>  use_cookies <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  highlight_unanswered <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  highlight_color <span class="op">=</span> <span class="st">"gray"</span>,</span>
<span>  capture_metadata <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-db">db<a class="anchor" aria-label="anchor" href="#arg-db"></a></dt>
<dd><p>A list containing database connection information created using
<code><a href="sd_database.html">sd_database()</a></code> function. Defaults to <code>NULL</code>.</p></dd>


<dt id="arg-required-questions">required_questions<a class="anchor" aria-label="anchor" href="#arg-required-questions"></a></dt>
<dd><p>Vector of character strings. The IDs of questions
that must be answered. Defaults to <code>NULL</code>.</p></dd>


<dt id="arg-all-questions-required">all_questions_required<a class="anchor" aria-label="anchor" href="#arg-all-questions-required"></a></dt>
<dd><p>Logical. If <code>TRUE</code>, all questions in the
survey will be required. Defaults to <code>FALSE</code>.</p></dd>


<dt id="arg-start-page">start_page<a class="anchor" aria-label="anchor" href="#arg-start-page"></a></dt>
<dd><p>Character string. The ID of the page to start on.
Defaults to <code>NULL</code>.</p></dd>


<dt id="arg-auto-scroll">auto_scroll<a class="anchor" aria-label="anchor" href="#arg-auto-scroll"></a></dt>
<dd><p>Logical. Whether to enable auto-scrolling to the next
question after answering. Defaults to <code>FALSE</code>.</p></dd>


<dt id="arg-rate-survey">rate_survey<a class="anchor" aria-label="anchor" href="#arg-rate-survey"></a></dt>
<dd><p>Logical. If <code>TRUE</code>, shows a rating question when exiting
the survey. If <code>FALSE</code>, shows a simple confirmation dialog.
Defaults to <code>FALSE</code>.</p></dd>


<dt id="arg-language">language<a class="anchor" aria-label="anchor" href="#arg-language"></a></dt>
<dd><p>Set the language for the survey system messages. Include
your own in a <code>translations.yml</code> file, or choose a built in one from
the following list: English (<code>"en"</code>), German (<code>"de"</code>), Spanish (<code>"es"</code>),
French (<code>"fr"</code>), Italian (<code>"it"</code>), Simplified Chinese (<code>"zh-CN"</code>).
Defaults to <code>"en"</code>.</p></dd>


<dt id="arg-use-cookies">use_cookies<a class="anchor" aria-label="anchor" href="#arg-use-cookies"></a></dt>
<dd><p>Logical. If <code>TRUE</code>, enables cookie-based session management
for storing and restoring survey progress. Defaults to <code>TRUE</code>.</p></dd>


<dt id="arg-highlight-unanswered">highlight_unanswered<a class="anchor" aria-label="anchor" href="#arg-highlight-unanswered"></a></dt>
<dd><p>Logical. If <code>TRUE</code>, enables highlighting
of all unanswered questions on page display. Defaults to <code>TRUE</code>.</p></dd>


<dt id="arg-highlight-color">highlight_color<a class="anchor" aria-label="anchor" href="#arg-highlight-color"></a></dt>
<dd><p>Character string. Color for highlighting unanswered
questions. Options are "blue", "orange", "green", "purple", "gray", or "grey".
Defaults to "gray".</p></dd>


<dt id="arg-capture-metadata">capture_metadata<a class="anchor" aria-label="anchor" href="#arg-capture-metadata"></a></dt>
<dd><p>Logical. If <code>TRUE</code>, automatically captures and stores
browser information (browser name, version, and OS), IP address, and
screen resolution.
Defaults to <code>TRUE</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>This function does not return a value; it sets up the server-side logic for
the 'shiny' application.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The function performs the following tasks:</p><ul><li><p>Initializes variables and reactive values.</p></li>
<li><p>Implements conditional display logic for questions.</p></li>
<li><p>Tracks answered questions and updates the progress bar.</p></li>
<li><p>Handles page navigation and skip logic.</p></li>
<li><p>Manages required questions.</p></li>
<li><p>Performs database operation.</p></li>
<li><p>Controls auto-scrolling behavior based on the <code>auto_scroll</code> argument.</p></li>
<li><p>Uses sweetalert for warning messages when required questions are not
answered.</p></li>
<li><p>Handles the exit survey process based on the <code>rate_survey</code> argument.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="progress-bar">Progress Bar<a class="anchor" aria-label="anchor" href="#progress-bar"></a></h2>


<p>The progress bar is updated based on the last answered question. It will jump
to the percentage corresponding to the last answered question and will never
decrease, even if earlier questions are answered later. The progress is
calculated as the ratio of the last answered question's index to the total
number of questions.</p>
    </div>
    <div class="section level2">
    <h2 id="database-operations">Database Operations<a class="anchor" aria-label="anchor" href="#database-operations"></a></h2>


<p>If <code>db</code> is provided, the function will update the database with survey
responses. If <code>db</code> is <code>NULL</code> (ignore mode), responses will be saved to a local
CSV file.</p>
    </div>
    <div class="section level2">
    <h2 id="auto-scrolling">Auto-Scrolling<a class="anchor" aria-label="anchor" href="#auto-scrolling"></a></h2>


<p>When <code>auto_scroll</code> is <code>TRUE</code>, the survey will automatically scroll to the
next question after the current question is answered. This behavior can be
disabled by setting <code>auto_scroll = FALSE</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="exit-survey">Exit Survey<a class="anchor" aria-label="anchor" href="#exit-survey"></a></h2>


<p>When <code>rate_survey = TRUE</code>, the function will show a rating question when
the user attempts to exit the survey. When <code>FALSE</code>, it will show a simple
confirmation dialog. The rating, if provided, is saved with the survey data.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="sd_database.html">sd_database()</a></code>, <code><a href="sd_ui.html">sd_ui()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pkg.surveydown.org">surveydown</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Get path to example survey file</span></span></span>
<span class="r-in"><span>  <span class="va">survey_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples"</span>, <span class="st">"basic_survey.qmd"</span>,</span></span>
<span class="r-in"><span>                             package <span class="op">=</span> <span class="st">"surveydown"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Copy to a temporary directory</span></span></span>
<span class="r-in"><span>  <span class="va">temp_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span><span class="va">survey_path</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">temp_dir</span>, <span class="st">"survey.qmd"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">orig_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="va">temp_dir</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Define a minimal server</span></span></span>
<span class="r-in"><span>  <span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="co"># sd_server() accepts these following parameters</span></span></span>
<span class="r-in"><span>    <span class="fu">sd_server</span><span class="op">(</span></span></span>
<span class="r-in"><span>      db <span class="op">=</span> <span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>      required_questions <span class="op">=</span> <span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>      all_questions_required <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>      start_page <span class="op">=</span> <span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>      auto_scroll <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>      rate_survey <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>      language <span class="op">=</span> <span class="st">"en"</span>,</span></span>
<span class="r-in"><span>      use_cookies <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>      highlight_unanswered <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>      highlight_color <span class="op">=</span> <span class="st">"gray"</span>,</span></span>
<span class="r-in"><span>      capture_metadata <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Run the app</span></span></span>
<span class="r-in"><span>  <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html" class="external-link">shinyApp</a></span><span class="op">(</span>ui <span class="op">=</span> <span class="fu"><a href="sd_ui.html">sd_ui</a></span><span class="op">(</span><span class="op">)</span>, server <span class="op">=</span> <span class="va">server</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Clean up</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="va">orig_dir</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by John Paul Helveston, Pingfan Hu, Bogdan Bunea.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

